<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Payment | SAMGATHA X VASHIST</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
    .navbar { background: linear-gradient(90deg,  #020744, #67c8f5); }
    .main-title { font-size: 2.2rem; font-weight: bold; }
    .sub-title { font-size: 1.3rem; }
    .timer-text { font-size: 1.1rem; color: #020744; margin-bottom: 1rem; }
    .navbar-brand {
    color: white !important;
    font-weight: bold;
    white-space: normal !important; /* Allow wrapping */
    word-break: break-word;
  }
    .payment-card {
      max-width: 500px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(2,7,68,0.08);
      padding: 2rem 2.5rem 4.5rem 2.5rem;
      position: relative;
    }
    .details-list {
      text-align: left;
      margin: 2rem 0 2.5rem 0;
      font-size: 1.1rem;
    }
   .details-list dt {
      font-weight: 600;
      color: #020744;
    }
    .details-list dd {
      margin-bottom: 1rem;
      margin-left: 0;
      color: #333;
    }
    .qr-img {
      margin: 1.5rem 0;
    }
    .action-row {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      padding: 0 2.5rem;
    }
    .cancel-btn {
      background-color: #dc3545;
      border: none;
      color: #fff;
      font-weight: 500;
      padding: 0.6rem 1.5rem;
      border-radius: 6px;
    }
    .cancel-btn:hover { background-color: #a71d2a; }
    .proceed-btn {
      background-color: #3399cc;
      border: none;
      color: #fff;
      font-weight: 500;
      padding: 0.6rem 1.5rem;
      border-radius: 6px;
    }
    .proceed-btn:hover { background-color: #2677a7; }
  </style>
</head>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
<nav class="navbar navbar-dark">
    <div class="container">
      <a class="navbar-brand text-wrap" href="#">
        <img src="/images/logo.png" alt="" width="40" height="40" class="d-inline-block align-text-top me-2">
        IIITDM Kancheepuram - Samgatha X Vashist
      </a>
    </div>
  </nav>

  <div class="payment-card">
    <h3 class="main-title text-center">Pay for Your Tickets</h3>
    <div class="timer-text text-center">
      This payment will end in <span id="timer">05:00</span>
    </div>
    <dl class="details-list">
      <dt>Name:</dt>
      <dd><%= Array.isArray(Name) ? Name.join(', ') : Name %></dd>
      <dt>Roll No.:</dt>
      <dd><%= Array.isArray(RollNo) ? RollNo.join(', ') : RollNo %></dd>
      <dt>Number of Tickets:</dt>
      <dd><%= Numoftickets %></dd>
      <dt>Total Amount:</dt>
      <dd>â‚¹<%= amount %></dd>
      <dt>Email:</dt>
      <dd><%= Email %></dd>
    </dl>

    <div class="action-row">
      <form action="BOOKING" method="POST">
        <input type="hidden" name="order_id" value="<%= order_id %>">
        <input type ="submit" value="Edit Details" href="BOOKING" class="cancel-btn">
      </form>
        <button id="rzp-button" class="proceed-btn">Proceed to Pay</button>

    </div>
  </div>

  <script>
    // Timer duration in seconds
    const duration = 300;
    const timerEl = document.getElementById('timer');
    const startTime = Date.now();

    function updateTimer() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const remaining = Math.max(duration - elapsed, 0);
      const min = String(Math.floor(remaining / 60)).padStart(2, '0');
      const sec = String(remaining % 60).padStart(2, '0');
      timerEl.textContent = `${min}:${sec}`;
            if (remaining > 0) {
        setTimeout(updateTimer, 1000);
      } else {
        timerEl.textContent = "00:00";
        alert("Payment session has expired. Please try booking again.");
        window.location.href = "BOOKING";
      }
    }
    updateTimer();
  </script>

  <script>
    document.getElementById('rzp-button').onclick = function(e){
      var options = {
        "key": "<%= key_id %>",
        "amount": "<%= amount *100%>", 
        "currency": "INR",
        "name": "IIITDM Kancheepuram - Samgatha X Vashist",
        "description": "Test Transaction",
        "order_id": "<%= order_id %>",
        "handler": function (response){
          // Not trusted for marking payment as complete
          window.location.href = "/success/<%= order_id %>";
        },
        "theme": { "color": "#3399cc" },
            "method": {
          upi: true,     // try to force UPI
          card: true,    // fallback if UPI unavailable
          wallet: true 
    },
    "modal": {
          ondismiss: function(){
            console.log("Payment popup closed by user.");
          }
        }
      };
      var rzp1 = new Razorpay(options);
      rzp1.on('payment.failed', function (response){
      alert("Payment failed: " + response.error.description);
      window.location.href = "/BOOKING"; // Redirect to booking page
    });
      rzp1.open();
      e.preventDefault();
    }
  </script>
</body>
</html>
